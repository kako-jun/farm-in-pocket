# Farm in Pocket - 電源設計

最終更新: 2025-11-17

## 電源設計の基本方針

### 原則

1. **基本はAC電源直結** - 持続可能性と交換回数削減
2. **guardポッドのみモバイルバッテリー対応** - 畑周囲は電源なし
3. **ソーラー充電との組み合わせ** - 長期運用を実現
4. **省電力設計** - バッテリー駆動時間を最大化

---

## ポッドごとの電源要件

### 1. farminpocket-atmosphere（大気環境監視）

**設置場所**: ハウス内（電源あり）

**消費電力**:
- Raspberry Pi Zero W: 約1.2W（0.24A @ 5V）
- Raspberry Pi 4: 約2.5W（0.5A @ 5V）
- DHT22センサー: 約0.015W（3mA @ 5V）
- **合計**: 約1.2〜2.5W

**電源方式**:
- ✅ **AC電源直結（推奨）**
- Raspberry Pi公式ACアダプタ（5V 3A）

**年間電気代**:
```
1.2W × 24h × 365日 × 31円/kWh = 約327円/年（Pi Zero W）
2.5W × 24h × 365日 × 31円/kWh = 約680円/年（Pi 4）
```

---

### 2. farminpocket-water（潅水制御）

**設置場所**: ハウス内または畑（電源あり）

**消費電力**:
- Raspberry Pi Zero W: 約1.2W
- 土壌湿度センサー: 約0.05W
- 電磁弁（12V, 待機時）: 約0W
- 電磁弁（動作時）: 約5W（10分/日）
- **平均**: 約1.3W

**電源方式**:
- ✅ **AC電源直結（必須）**
- 電磁弁用に12V電源も必要
- リレーモジュールで制御

**構成例**:
```
AC 100V
 ├→ 5V 3A アダプタ（Raspberry Pi用）
 └→ 12V 1A アダプタ（電磁弁用）
```

**年間電気代**: 約360円/年

---

### 3. farminpocket-camera（撮影記録）

**設置場所**: ハウス内（電源あり）

**消費電力**:
- Raspberry Pi 4: 約2.5W（待機時）
- Raspberry Pi Camera: 約1.3W（撮影時）
- **平均**: 約2.7W

**電源方式**:
- ✅ **AC電源直結（推奨）**
- Raspberry Pi公式ACアダプタ（5V 3A）

**年間電気代**: 約730円/年

---

### 4. farminpocket-guard（害獣対策）⚡

**設置場所**: 畑の周囲（**電源なし**の可能性大）

**消費電力**:
- Raspberry Pi Zero W: 約1.2W（待機時）
- PIRセンサー: 約0.3W
- LED（威嚇時、5分/日）: 約3W
- スピーカー（威嚇時、5分/日）: 約2W
- **平均**: 約1.5W

**電源方式**:
- ⚡ **モバイルバッテリー + ソーラー充電（推奨）**
- 🔋 車用バッテリー + ソーラー（長期運用）
- ⚡ AC電源（利用可能な場合）

**バッテリー駆動時間**:
```
20,000mAh × 3.7V = 74Wh
74Wh ÷ 1.5W = 約49時間（2日間）

※ ソーラー充電なしの場合
```

**ソーラー充電込み**:
```
10Wソーラーパネル × 5時間（日照時間）= 50Wh/日
消費電力: 1.5W × 24h = 36Wh/日

→ 収支: +14Wh/日（持続可能）
```

---

### 5. farminpocket-gateway（データ送信）

**設置場所**: ハウス内（電源あり）

**消費電力**:
- Raspberry Pi Zero W: 約1.2W
- Wi-Fi通信: 約0.3W
- **合計**: 約1.5W

**電源方式**:
- ✅ **AC電源直結（推奨）**

**年間電気代**: 約410円/年

---

## 電源ソリューション詳細

### パターン1: AC電源直結（atmosphere, water, camera, gateway）

**必要機器**:
- Raspberry Pi公式ACアダプタ（5V 3A）: 約1,500円
- UPS（オプション、停電対策）: 約5,000円〜

**メリット**:
- ✅ 交換不要、メンテナンスフリー
- ✅ 安定した電力供給
- ✅ 低コスト

**デメリット**:
- ❌ 電源が必要な場所にしか設置できない
- ❌ 停電時に停止（UPSで対策可能）

**10年間コスト**:
```
初期費用: 1,500円
電気代: 約400円/年 × 10年 = 4,000円
合計: 5,500円
```

---

### パターン2: モバイルバッテリー + ソーラー充電（guard推奨）

**必要機器**:
- モバイルバッテリー（20,000mAh以上）: 約3,000円
- ソーラーパネル（10W）: 約2,500円
- 防水ケース: 約1,500円
- **合計**: 約7,000円

**メリット**:
- ✅ 電源なし場所に設置可能
- ✅ ソーラー充電で持続可能
- ✅ 移動が容易

**デメリット**:
- ❌ 初期費用がやや高い
- ❌ バッテリー交換が必要（2〜3年ごと）
- ❌ 曇天・雨天で充電不足の可能性

**推奨構成（guardポッド）**:
```
ソーラーパネル（10W）
  ↓
充電コントローラー
  ↓
モバイルバッテリー（20,000mAh）
  ↓ USB 5V
Raspberry Pi Zero W
```

**10年間コスト**:
```
初期費用: 7,000円
バッテリー交換: 3,000円 × 3回 = 9,000円
合計: 16,000円
```

**ソーラーパネル選定**:
- 出力: 10W以上
- 出力電圧: 5V USB出力
- 防水性能: IP65以上
- 例: Anker PowerPort Solar（約2,500円）

**モバイルバッテリー選定**:
- 容量: 20,000mAh以上
- パススルー充電対応（充電しながら給電）
- 例: Anker PowerCore 20100（約3,000円）

---

### パターン3: 車用バッテリー + ソーラー（長期運用のguard）

**必要機器**:
- 12Vディープサイクルバッテリー（50Ah）: 約8,000円
- ソーラーパネル（20W）: 約4,000円
- ソーラーチャージコントローラー（10A）: 約2,000円
- DC-DCコンバータ（12V→5V 3A）: 約1,000円
- 防水ボックス: 約2,000円
- **合計**: 約17,000円

**メリット**:
- ✅ 超長期運用可能（バッテリー寿命5年以上）
- ✅ 大容量（数日間の曇天でも動作）
- ✅ 信頼性が高い

**デメリット**:
- ❌ 初期費用が高い
- ❌ 重い（設置場所固定）
- ❌ やや複雑な配線

**推奨構成（長期運用guardポッド）**:
```
ソーラーパネル（20W）
  ↓
チャージコントローラー（10A）
  ↓
12Vバッテリー（50Ah）
  ↓
DC-DCコンバータ（12V→5V）
  ↓ USB 5V
Raspberry Pi Zero W
```

**バッテリー駆動時間**:
```
50Ah × 12V = 600Wh
600Wh ÷ 1.5W = 約400時間（16日間）

※ ソーラー充電なしの場合
```

**10年間コスト**:
```
初期費用: 17,000円
バッテリー交換: 8,000円 × 2回 = 16,000円
合計: 33,000円
```

---

## guardポッドの省電力設計

モバイルバッテリー運用を最適化するため、省電力設計が重要。

### 1. Raspberry Pi Zero Wを使用

**消費電力比較**:
- Raspberry Pi 4: 約2.5W
- Raspberry Pi Zero W: 約1.2W（52%削減）

### 2. スリープモードの活用

**動作モード**:
- 通常時: PIRセンサーのみ動作（Pi本体はスリープ）
- 検知時: Piを起動 → 威嚇 → 再びスリープ

**消費電力**:
```
スリープ時: 約0.1W
動作時: 約1.5W（5分/日のみ）

平均消費電力: 約0.15W
```

**バッテリー駆動時間**:
```
20,000mAh × 3.7V = 74Wh
74Wh ÷ 0.15W = 約493時間（20日間）

→ ソーラー充電と組み合わせで無限駆動
```

### 3. 低消費電力センサーの選択

- PIRセンサー: HC-SR501（約0.065W）
- LED: 高輝度LED（必要時のみ点灯）

### 4. 通信の最適化

- Wi-Fi: 省電力モード有効化
- データ送信: バッチ送信（1日1回など）

---

## 停電対策（AC電源ポッド）

ハウス内のAC電源ポッドも停電リスクがある。

### UPS（無停電電源装置）の導入

**小型UPS**:
- 容量: 50Wh程度
- 価格: 約5,000円
- 駆動時間: 約20時間（Raspberry Pi単体）

**例**:
- Anker PowerHouse 100（約15,000円、97Wh）
- CyberPower CP425SLG（約6,000円、255Wh）

**メリット**:
- 停電時も継続動作
- 電圧変動の吸収
- データ保護

---

## コスト比較（10年間）

| ポッド | 電源方式 | 初期費用 | 年間電気代 | 交換費用 | 10年総額 |
|--------|---------|---------|-----------|---------|---------|
| atmosphere | AC電源 | ¥1,500 | ¥330 | - | ¥4,800 |
| water | AC電源 | ¥3,000 | ¥360 | - | ¥6,600 |
| camera | AC電源 | ¥1,500 | ¥730 | - | ¥8,800 |
| guard（バッテリー） | モバイル+ソーラー | ¥7,000 | - | ¥9,000 | ¥16,000 |
| guard（車バッテリー） | 12V+ソーラー | ¥17,000 | - | ¥16,000 | ¥33,000 |
| gateway | AC電源 | ¥1,500 | ¥410 | - | ¥5,600 |

**全ポッド合計（guard=モバイル）**:
- 初期費用: ¥14,500
- 10年総額: ¥41,800

---

## 推奨構成まとめ

### 基本セット（電源あり環境）

```
atmosphere: AC電源直結（¥1,500）
water: AC電源直結（¥3,000）
camera: AC電源直結（¥1,500）
gateway: AC電源直結（¥1,500）

合計: ¥7,500
```

### 害獣対策セット（電源なし環境）

```
guard: モバイルバッテリー + 10Wソーラー（¥7,000）

→ 小規模・短期運用に最適
```

または

```
guard: 車用バッテリー + 20Wソーラー（¥17,000）

→ 大規模・長期運用に最適
```

---

## 実装ガイド

### guardポッドのバッテリー駆動実装

**1. ハードウェア接続**

```
[ソーラーパネル] → [モバイルバッテリー] → [Raspberry Pi Zero W]
                            ↓
                      [PIRセンサー]
                      [LED]
                      [スピーカー]
```

**2. 省電力設定（config.json）**

```json
{
  "enable_sleep_mode": true,
  "sleep_threshold_minutes": 5,
  "battery_monitor": true,
  "low_battery_threshold": 20,
  "solar_charging": true
}
```

**3. バッテリー監視スクリプト**

```python
# Raspberry Piのバッテリー残量監視
import subprocess

def get_battery_level():
    # INA219電流センサーなどで測定
    # または電圧測定（ADC）
    pass

def check_low_battery():
    level = get_battery_level()
    if level < 20:
        # 省電力モードに移行
        enable_deep_sleep()
```

---

## トラブルシューティング

### 問題1: guardポッドのバッテリーが持たない

**原因**:
- ソーラーパネルの日照不足
- バッテリー劣化
- 消費電力が想定より多い

**対策**:
1. ソーラーパネルの角度調整（南向き、30度傾斜）
2. パネル表面の清掃
3. バッテリー交換
4. 省電力設定の見直し

### 問題2: 停電時にデータが消失

**原因**:
- UPSなしでシャットダウン
- SDカードの書き込み中に電源断

**対策**:
1. UPSの導入
2. データのクラウド同期
3. ログ書き込みの最適化（バッファリング）

---

この電源設計により、Farm in Pocketは持続可能で低コストな運用を実現します。
